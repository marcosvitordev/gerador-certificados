<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Valida√ß√£o de Certificado</title>
    <link rel="stylesheet" href="css/style.css">
    <script>
        async function carregarCertificado() {
            const params = new URLSearchParams(window.location.search);
            const codigo = params.get("codigo");

            if (!codigo) {
                document.getElementById("info").innerHTML = "<p style='color:red;'>C√≥digo inv√°lido!</p>";
                return;
            }

            try {
                const res = await fetch(`/api/validar/${codigo}`);
                const certificado = await res.json();

                if (certificado.erro) {
                    document.getElementById("info").innerHTML = "<p style='color:red;'>Certificado n√£o encontrado! Procure o administrador ou a escola.</p>";
                    return;
                }

                document.getElementById("info").innerHTML = `
                    <h2>‚úÖ Certificado V√°lido</h2>
                    <p><strong>Nome:</strong> ${certificado.nome}</p>
                    <p><strong>Data de In√≠cio:</strong> ${certificado.data_inicio}</p>
                    <p><strong>Data de T√©rmino:</strong> ${certificado.data_fim}</p>
                    <p><strong>Escola:</strong> ${certificado.escola}</p>
                    <p><strong>Professor:</strong> ${certificado.professor}</p>
                    <p><strong>C√≥digo de Autenticidade:</strong> ${certificado.codigo}</p>
                    <a href="/download/${certificado.codigo}" download>üìÑ Baixar Certificado (PDF)</a>
                    <h3>Visualizar Certificado:</h3>
                    <iframe id="pdfViewer" width="100%" height="500px"></iframe>
                `;

                // Exibir o PDF no iframe
                document.getElementById("pdfViewer").src = `/certificados/${certificado.codigo}.pdf`;
            } catch (error) {
                document.getElementById("info").innerHTML = "<p style='color:red;'>Erro ao buscar certificado!</p>";
            }
        }

        window.onload = carregarCertificado;
    </script>
</head>
<body>
    <h1>Autentica√ß√£o de Certificado</h1>
    <div id="info">Carregando...</div>
</body>
</html>
